<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Lorry App</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body class="login-page">
  <div class="login-card">
    <h1>Welcome!</h1>
    <p>Enter your phone number</p>
    <form id="loginForm" class="login-form" onsubmit="login(event)">
      <div class="form-group">
        <label for="phoneNumber">Phone Number</label>
        <input type="tel" id="phoneNumber" name="phoneNumber" 
          maxlength="10" minlength="10" 
          pattern="[6-9]{1}[0-9]{9}" 
          placeholder="Enter 10-digit number"
          aria-describedby="phoneHint"
          required />
        <small id="phoneHint" class="input-hint">
          ðŸ“± Please enter the phone number you used during registration
        </small>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" 
          placeholder="Enter password" 
          autocomplete="current-password"
          required />
      </div>

      <button type="submit" class="btn-green">Login</button>
    </form>

    <div class="signup-link">
      New user? <a href="signup.html">Sign up here</a>
    </div>
  </div>

  <script>
    // Show error message below the input
    function showError(inputId, message) {
      const input = document.getElementById(inputId);
      let errorDiv = input.parentElement.querySelector('.error-message');
      
      if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.style.color = 'red';
        errorDiv.style.fontSize = '14px';
        errorDiv.style.marginTop = '5px';
        input.parentElement.appendChild(errorDiv);
      }
      
      errorDiv.textContent = message;
      input.setAttribute('aria-invalid', 'true');
      input.focus();
    }

    // Clear error message
    function clearError(inputId) {
      const input = document.getElementById(inputId);
      const errorDiv = input.parentElement.querySelector('.error-message');
      if (errorDiv) {
        errorDiv.remove();
      }
      input.removeAttribute('aria-invalid');
    }

    // Phone number input validation
    document.getElementById("phoneNumber").addEventListener("input", function(e) {
      this.value = this.value.replace(/\D/g, ""); // Only digits
      clearError('phoneNumber');
    });

    // Login form submission
    function login(event) {
      event.preventDefault();
      
      const phone = document.getElementById("phoneNumber").value;
      const password = document.getElementById("password").value;

      // Clear any existing errors
      clearError('phoneNumber');
      clearError('password');

      // Validate inputs
      if (phone.length !== 10) {
        showError('phoneNumber', "Please enter a valid 10-digit phone number.");
        return;
      }
      
      if (!password) {
        showError('password', "Please enter your password.");
        return;
      }

      // Check user credentials
      let users = JSON.parse(localStorage.getItem('users')) || [];
      const user = users.find(u => u.phone === phone);

      if (!user) {
        showError('phoneNumber', "Phone number not registered. Please sign up first.");
        return;
      }

      if (user.password !== password) {
        showError('password', "Incorrect password. Please try again.");
        return;
      }

      // Save logged in user info to localStorage
      localStorage.setItem('currentUser', JSON.stringify(user));

      // Redirect to OTP verification
      window.location.href = "otpVerificationPage.html";
    }
  </script>
</body>

</html>